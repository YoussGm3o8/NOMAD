# NOMAD Edge Core Environment Configuration
# Target: NVIDIA Jetson Orin Nano
# Copy to .env and customize for your deployment

# ============================================================
# Network Configuration
# ============================================================

# Edge Core API server
NOMAD_HOST=0.0.0.0
NOMAD_PORT=8000

# MAVLink Router endpoints
MAVLINK_ORCHESTRATOR_PORT=14550
MAVLINK_VISION_PORT=14551

# Tailscale VPN (for GCS remote access)
TS_AUTHKEY=
VPN_TAILSCALE_HOSTNAME=nomad-jetson
# Get IP with: tailscale ip -4
# Jetson Tailscale IP: 100.75.218.89
# Ground Station IP: 100.76.127.17
TAILSCALE_IP=100.75.218.89
GCS_IP=100.76.127.17
GCS_PORT=14552

# ============================================================
# Hardware Configuration
# ============================================================

# UART connection to Cube Orange
MAVLINK_UART_DEV=/dev/ttyTHS1
MAVLINK_UART_BAUD=921600

# ZED 2i Camera
ZED_SERIAL_NUMBER=
ZED_RESOLUTION=HD720
ZED_FPS=30

# Vision model
VISION_MODEL_PATH=/opt/nomad/models/yolov8n.pt

# Media server
MEDIA_SERVER_URL=rtsp://mediamtx:8554/

# ============================================================
# Feature Flags
# ============================================================

# Enable/disable vision process
NOMAD_ENABLE_VISION=true

# Watchdog timeout (seconds)
NOMAD_WATCHDOG_TIMEOUT=5.0

# Debug mode
NOMAD_DEBUG=false

# ============================================================
# Paths
# ============================================================

# Landmarks configuration
NOMAD_LANDMARKS_PATH=/home/nomad/NOMAD/config/landmarks.json

# Mission logs directory
NOMAD_LOG_DIR=/home/nomad/NOMAD/data/mission_logs

# ============================================================
# Task Configuration
# ============================================================

# Task 1 (Outdoor Recon) - Uses GPS navigation
TASK1_ENABLED=true
TASK1_AUTO_CAPTURE=false

# Task 2 (Indoor Extinguish) - Uses VIO navigation
TASK2_ENABLED=true
TASK2_EXCLUSION_THRESHOLD=0.5

# Gimbal PID gains
GIMBAL_PID_KP=0.5
GIMBAL_PID_KI=0.1
GIMBAL_PID_KD=0.05

# ============================================================
# VIO Configuration (Task 2)
# ============================================================

# VIO output rate (Hz)
VIO_OUTPUT_RATE=30

# Confidence thresholds
VIO_CONFIDENCE_WARNING=50
VIO_CONFIDENCE_CRITICAL=30

# Enable MAVLink VISION_POSITION_ESTIMATE output
VIO_MAVLINK_ENABLED=true

# Position filtering (0-1, higher = less filtering)
VIO_FILTER_ALPHA=0.8

# ============================================================
# ZED Camera Settings
# ============================================================

# ZED depth mode: PERFORMANCE, QUALITY, ULTRA, NEURAL
ZED_DEPTH_MODE=NEURAL

# ZED depth range (meters)
ZED_DEPTH_MIN=0.3
ZED_DEPTH_MAX=20.0

# Positional tracking
ZED_TRACKING_ENABLED=true
ZED_IMU_FUSION_ENABLED=true
ZED_AREA_MEMORY_ENABLED=false

# Streaming settings
ZED_STREAMING_ENABLED=true
ZED_STREAMING_CODEC=H264
ZED_STREAMING_BITRATE=4000
ZED_STREAMING_PORT=30000

# ============================================================
# Isaac ROS Configuration (Optional)
# ============================================================

# Enable Isaac ROS bridge (if Isaac ROS is installed)
# Set to false to use direct ZED SDK instead
ISAAC_ROS_ENABLED=false

# Isaac ROS topics (when ISAAC_ROS_ENABLED=true)
ISAAC_VIO_TOPIC=/visual_slam/tracking/odometry
ISAAC_DETECTION_TOPIC=/yolov8/detections
ISAAC_IMAGE_TOPIC=/zed/zed_node/rgb/image_rect_color
ISAAC_DEPTH_TOPIC=/zed/zed_node/depth/depth_registered

# Isaac ROS node name
ISAAC_NODE_NAME=nomad_bridge

# ============================================================
# Object Detection (YOLO)
# ============================================================

# YOLO model to use
YOLO_MODEL_PATH=/opt/nomad/models/yolov8n.pt

# Detection confidence threshold
YOLO_CONFIDENCE=0.5

# Classes to detect (comma-separated IDs, empty = all)
# Common classes: 0=person, 56=chair (COCO)
# Fire classes may need custom model training
YOLO_CLASSES=

# Detection frame rate (Hz)
YOLO_FPS=10

# ============================================================
# Exclusion Map Configuration
# ============================================================

# Automatic exclusion based on YOLO tracking
EXCLUSION_AUTO_ENABLED=true

# Spatial threshold for considering targets "same" (meters)
EXCLUSION_RADIUS=0.5

# Time threshold for target persistence (seconds)
EXCLUSION_PERSISTENCE=300.0
